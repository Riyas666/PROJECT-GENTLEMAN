<%-include("../../views/partials/user/header")%>
<style>
 .input-group {
    position: relative; /* This allows absolute positioning of child elements */
    width: 100%; /* Full width for the input group */
}

.edit-icon {
    font-size: 24px; /* Increase size for better visibility */
    color: #007bff; /* Primary color for visibility */
    cursor: pointer; /* Pointer cursor for clickable icons */
    position: absolute; /* Positioning the icon within the input group */
    top: 50%; /* Center vertically */
    right: 10px; /* Position from the right */
    transform: translateY(-50%); /* Adjust to center vertically */
    transition: color 0.2s ease, transform 0.2s ease; /* Smooth transitions for hover effects */
}

.edit-icon:hover {
    color: #0056b3; /* Darker shade on hover for better feedback */
    transform: scale(1.1); /* Slightly enlarge on hover for emphasis */
}

.edit-icon.fa-lock {
    cursor: not-allowed; /* Not allowed cursor for lock icon */
    opacity: 0.5; /* Reduced opacity for disabled state */
}

.form__input:disabled {
    background-color: #f5f5f5; /* Light gray background for disabled inputs */
    cursor: not-allowed; /* Not allowed cursor for disabled inputs */
}

.form__input:enabled {
    background-color: #fff; /* White background for enabled inputs */
}

.btn:disabled {
    opacity: 0.5; /* Reduced opacity for disabled buttons */
    cursor: not-allowed; /* Not allowed cursor for disabled buttons */
}

.address__actions {
  margin-top: 10px;
  display: flex;
  gap: 10px;
} 
.btn {
  padding: 8px 12px;
  font-size: 14px;
  border: none;
  cursor: pointer;
  border-radius: 4px;
} 
.btn--sm {
  font-size: 12px;
  background-color: #ffc107;
  color: #000;
}

.btn--lg {
  font-size: 14px;
  background-color: #007bff;
  color: #fff;
  padding: 10px 20px;
}

.btn:hover {
  opacity: 0.9;
}

.add__address {
  margin-top: 20px;
}

.tab__headerr{
  font-size: 1.1rem;
}


.address-form-container {
                  max-width: 450px; /* Reduced from 600px */
                  margin: 1rem auto; /* Reduced from 2rem */
                  padding: 1.25rem; /* Reduced from 2rem */
                  background-color: #ffffff;
                  border-radius: 8px; /* Reduced from 12px */
                  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
                  width: 90%;
              }
          
              .address-form-container h2 {
                  color: #2c3e50;
                  margin-bottom: 1rem; /* Reduced from 1.5rem */
                  font-weight: 600;
                  text-align: center;
                  padding-bottom: 0.75rem; /* Reduced from 1rem */
                  border-bottom: 1px solid #eee;
                  font-size: 1.25rem; /* Reduced from 1.5rem */
              }
          
              .form-control,
              .form-select {
                  border: 1px solid #e0e0e0;
                  padding: 0.5rem 0.75rem; /* Reduced padding */
                  border-radius: 6px; /* Reduced from 8px */
                  transition: all 0.3s ease;
                  width: 100%;
                  font-size: 0.875rem; /* 14px */
                  line-height: 1.4;
                  height: auto;
              }
          
              .form-label {
                  font-weight: 500;
                  color: #34495e;
                  margin-bottom: 0.25rem; /* Reduced from 0.5rem */
                  font-size: 0.875rem; /* 14px */
              }
          
              .btn-primary {
                  background-color: #3498db;
                  border: none;
                  padding: 0.5rem 1rem; /* Reduced padding */
                  font-weight: 500;
                  border-radius: 6px;
                  transition: all 0.3s ease;
                  width: 100%;
                  margin-top: 0.75rem; /* Reduced from 1rem */
                  font-size: 0.875rem; /* 14px */
              }
          
              .form-select {
                  padding-right: 2rem; /* Space for dropdown arrow */
                  background-size: 0.875rem;
              }
          
              .mb-3 {
                  margin-bottom: 0.75rem !important; /* Reduced from 1.5rem */
              }
          
              /* Tablet screens */
              @media screen and (max-width: 1023px) and (min-width: 768px) {
                  .address-form-container {
                      width: 80%;
                      padding: 1rem;
                      margin: 1rem auto;
                  }
              }
          
              /* Mobile screens */
              @media screen and (max-width: 767px) {
                  .address-form-container {
                      width: 95%;
                      padding: 1rem;
                      margin: 0.75rem auto;
                  }
          
                  .mb-3 {
                      margin-bottom: 0.625rem !important;
                  }
          
                  .form-control,
                  .form-select {
                      padding: 0.4rem 0.625rem;
                      font-size: 0.875rem;
                  }
          
                  .btn-primary {
                      padding: 0.5rem 1rem;
                  }
              }
          
              /* Extra small screens */
              @media screen and (max-width: 380px) {
                  .address-form-container {
                      width: 98%;
                      padding: 0.875rem;
                  }
          
                  .form-control,
                  .form-select {
                      padding: 0.375rem 0.5rem;
                  }
              }
          
              /* Touch device optimization - maintaining minimum touch target size */
              @media (hover: none) {
                  .form-control,
                  .form-select,
                  .btn-primary {
                      min-height: 38px; /* Reduced but still touchable */
                  }
              }



</style>
    <!--=============== MAIN ===============-->
    <main class="main">
      <!--=============== BREADCRUMB ===============-->
      <section class="breadcrumb">
        <ul class="breadcrumb__list flex container">
          <li><a href="/home" class="breadcrumb__link">Home</a></li>
          <li><span class="breadcrumb__link">></span></li>
          <li><a href="/profile" class="breadcrumb__link">Profile</a></li>
        </ul>
      </section>

      <!--=============== ACCOUNTS ===============-->
      <section class="accounts section--lg">
        <div class="accounts__container container grid">
          <div class="account__tabs">
            <p class="account__tab active-tab" data-target="#update-profile">
              <i class="fi fi-rs-user"></i> Update Profile
            </p>
            <p class="account__tab " data-target="#dashboard">
              <i class="fi fi-rs-settings-sliders"></i> Wallet
            </p>
            <p class="account__tab" data-target="#orders">
              <i class="fi fi-rs-shopping-bag"></i> Orders
            </p>
           
            <p class="account__tab" data-target="#address">
              <i class="fi fi-rs-marker"></i> My Address
            </p>
            <p class="account__tab" data-target="#change-password">
              <i class="fi fi-rs-settings-sliders"></i> Change Password
            </p>
            <p class="account__tab"><i class="fi fi-rs-exit"></i> Logout</p>
          </div>
          <div class="tabs__content ">
            
            <div class="tab__content active-tab" content id="update-profile">
              <h3 class="tab__header">Update Profile</h3>
              <div class="tab__body">
                <form class="form grid" action="/profile" method="post" id="updateprofileform">
                  <input
                  id="name"
                    type="text"
                    value="<%=user.name%>"
                  placeholder="Username"
                    class="form__input"
                  name="name"
                  />
                  <span class="error-message" id="nameError"></span>
                  <input
                  id="email"
                  type="text"
                  value="<%=user.email%>"
                  placeholder="Email"
                  class="form__input"
                 disabled
                />
              
                <input
                id="phone"
                type="text"
                value="<%=user.phone%>"
                placeholder="Phone Number"
                class="form__input"
              name="phone"
              />
              <span class="error-message" id="phoneError"></span>
                  <div class="form__btn">
                    <button class="btn btn--md" type="submit">Save</button>
                  </div>
                </form>
              </div>
            </div>
            <div class="tab__content " content id="dashboard">
              <div class="container py-5">
                <div class="row">
                  <!-- Wallet Header -->
                  <div class="col-md-12 text-center mb-4">
                    <h1 class="fw-bold">My Wallet</h1>
                    <p class="text-muted">Manage your wallet balance and transactions here.</p>
                  </div>
                </div>
            
                <!-- Wallet Balance Section -->
                <div class="row justify-content-center">
                  <div class="col-md-6">
                    <div class="card shadow">
                      <div class="card-body text-center">
                        <h5 class="text-muted">Current Balance</h5>
                        <h2 class="fw-bold text-success">â‚¹ 12,500</h2>
                        <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addFundsModal">Add Funds</button>
                        <button class="btn btn-outline-danger mt-3 ms-2" data-bs-toggle="modal" data-bs-target="#withdrawModal">Withdraw</button>
                      </div>
                    </div>
                  </div>
                </div>
            
                <!-- Recent Transactions Section -->
                <div class="row mt-5">
                  <div class="col-md-12">
                    <h4 class="mb-3">Recent Transactions</h4>
                    <table class="table table-striped">
                      <thead class="table-dark">
                        <tr>
                          <th>#</th>
                          <th>Description</th>
                          <th>Date</th>
                          <th>Amount</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>Order #1234</td>
                          <td>2024-11-15</td>
                          <td class="text-danger">- â‚¹ 500</td>
                        </tr>
                        <tr>
                          <td>2</td>
                          <td>Wallet Recharge</td>
                          <td>2024-11-12</td>
                          <td class="text-success">+ â‚¹ 1000</td>
                        </tr>
                        <tr>
                          <td>3</td>
                          <td>Order #1228</td>
                          <td>2024-11-10</td>
                          <td class="text-danger">- â‚¹ 300</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            
              <!-- Add Funds Modal -->
              <div class="modal fade" id="addFundsModal" tabindex="-1" aria-labelledby="addFundsModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="addFundsModalLabel">Add Funds</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <form>
                        <div class="mb-3">
                          <label for="addAmount" class="form-label">Amount</label>
                          <input type="number" class="form-controll" id="addAmount" placeholder="Enter amount">
                        </div>
                        <button type="submit" class="btn btn-primary">Add Funds</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            
              <!-- Withdraw Modal -->
              <div class="modal fade" id="withdrawModal" tabindex="-1" aria-labelledby="withdrawModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="withdrawModalLabel">Withdraw Funds</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <form>
                        <div class="mb-3">
                          <label for="withdrawAmount" class="form-label">Amount</label>
                          <input type="number" class="form-controll" id="withdrawAmount" placeholder="Enter amount">
                        </div>
                        <button type="submit" class="btn btn-danger">Withdraw Funds</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab__content" content id="orders">
              <h3 class="tab__header">Your Orders</h3>
              <div class="tab__body">
                <table class="placed__order-table">
                  <thead>
                    <tr>
                      <th>Orders</th>
                      <th>Date</th>
                      <th>Status</th>
                      <th>Totals</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>#1357</td>
                      <td>March 19, 2022</td>
                      <td>Processing</td>
                      <td>$125.00</td>
                      <td><a href="#" class="view__order">View</a></td>
                    </tr>
                    <tr>
                      <td>#2468</td>
                      <td>June 29, 2022</td>
                      <td>Completed</td>
                      <td>$364.00</td>
                      <td><a href="#" class="view__order">View</a></td>
                    </tr>
                    <tr>
                      <td>#2366</td>
                      <td>August 02, 2022</td>
                      <td>Completed</td>
                      <td>$280.00</td>
                      <td><a href="#" class="view__order">View</a></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
           
            <!-- <div class="tab__content" content id="address">
              <h3 class="tab__header">Shipping Address</h3>
              <div class="tab__body">
                <address class="address">
                  3522 Interstate <br />
                  75 Business Spur, <br />
                  Sault Ste. <br />
                  Marie, Mi 49783
                </address>
                <p class="city">New York</p>
                <a href="#" class="edit">Edit</a>
              </div> -->




              <div class="tab__content" content id="address" style="width: 40%;">
                <div class="tab__header" style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; padding-bottom: 10px;">
                  <h3 class="tab__headerr">Shipping Address</h3>
                  <div class="header__actions" style="display: flex;">
                    <button class="edit-btn" style="background-color: orange; border-radius: 3px; color: white; padding: 7px; margin-right: 15px;" data-target="#edit-btn">Edit</button>
                    <button class="delete-btn" style="background-color: red; border-radius: 3px; color: white; padding: 7px; ">Delete</button>
                  </div>
                </div>
                <div class="tab__body">
                  <div class="address__item">
                    <address class="address">
                     name <br />
                      city, <br />
                      Landmark <br />
                      pincode, kerala <br/>
                      number
                    </address>
                    <p class="city">kerala</p>
                  </div>
                  <!-- Add Address Button -->
                  <div class="add__address">
                    <button class="add-btn" style="background-color: blue; border-radius: 3px; color: white; padding: 10px; margin-top: 10px;" data-target="#add-btn">Add New Address</button>
                  </div>
                </div>
              </div>    




              <div  class="tab__content address-form-container" content id="add-btn">
                <h2>Add Address</h2>
                <form method="post" id="addaddressform">
                


                    <div class="mb-3">
                        <label for="fullname" class="form-label">Full Name</label>
                        <input
                            type="text"
                            class="form-control"
                            id="addname"
                            name="name"
                            placeholder="Enter your full name"
                        />
                        <span class="error-message" id="addnameError"></span>
                    </div>
                   
                    <div class="mb-3">
                        <label for="city" class="form-label">City</label>
                        <input type="text" class="form-control" id="city" name="city" placeholder="Enter your city"  />
                        <span class="error-message" id="cityError"></span>
                    </div>
                   
                    <div style="display: flex; gap: 1rem; align-items: flex-start;">
                      <span class="mb-3" style="flex: 1;">
                          <label for="state" class="form-label" style="display: flex;">State</label>
                          <select id="state"  name="state" class="form-select" >
                              <option value="state" selected>state</option>
                              <option value="Andhra Pradesh">Andhra Pradesh</option>
                              <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                              <option value="Assam">Assam</option>
                              <option value="Bihar">Bihar</option>
                              <option value="Chhattisgarh">Chhattisgarh</option>
                              <option value="Goa">Goa</option>
                              <option value="Gujarat">Gujarat</option>
                              <option value="Haryana">Haryana</option>
                              <option value="Himachal Pradesh">Himachal Pradesh</option>
                              <option value="Jharkhand">Jharkhand</option>
                              <option value="Karnataka">Karnataka</option>
                              <option value="Kerala">Kerala</option>
                              <option value="Madhya Pradesh">Madhya Pradesh</option>
                              <option value="Maharashtra">Maharashtra</option>
                              <option value="Manipur">Manipur</option>
                              <option value="Meghalaya">Meghalaya</option>
                              <option value="Mizoram">Mizoram</option>
                              <option value="Nagaland">Nagaland</option>
                              <option value="Odisha">Odisha</option>
                              <option value="Punjab">Punjab</option>
                              <option value="Rajasthan">Rajasthan</option>
                              <option value="Sikkim">Sikkim</option>
                              <option value="Tamil Nadu">Tamil Nadu</option>
                              <option value="Telangana">Telangana</option>
                              <option value="Tripura">Tripura</option>
                              <option value="Uttar Pradesh">Uttar Pradesh</option>
                              <option value="Uttarakhand">Uttarakhand</option>
                              <option value="West Bengal">West Bengal</option>
                              <option value="Chandigarh">Chandigarh</option>
                              <option value="Delhi">Delhi</option>
                              <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                              <option value="Ladakh">Ladakh</option>
                          </select>
                          <span class="error-message" id="stateError"></span>
                      </span>
                      
                      <span class="mb-3" style="flex: 1;">
                          <label for="postalcode" class="form-label" style="display: flex;">Postal Code</label>
                          <input
                              type="text"
                              class="form-control"
                              id="pincode"
                              name="pincode"
                              placeholder="Enter your postal code"
                              
                          />
                          <span class="error-message" id="pincodeError"></span>

                      </span>
                     
                  </div>
                 
                  
                    <div class="mb-3">
                        <label for="landmark" class="form-label">Landmark</label>
                        <input type="text" class="form-control" id="landmark" name="landmark" placeholder="Enter a landmark " />
                        <span class="error-message" id="landmarkError"></span>
                    </div>
                   
                    <div class="mb-3">
                        <label for="phonenumber" class="form-label">Phone Number</label>
                        <input
                            type="text"
                            class="form-control"
                            id="addphone"
                            name="phonenumber"
                            placeholder="Enter your phone number"
                            
                        />
                        <span class="error-message" id="addphoneError"></span>
                    </div>
                   
                   


                  <div style="display: flex; gap: 1rem; align-items: flex-start;">
                    <span class="mb-3" style="flex: 1;">
                        <label for="addressType" class="form-label" style="display: flex;">Address</label>
                        <select  name="addressType"  id="addressType"  class="form-select" >
                            <option value="--none--"selected>--none--</option>
                            <option value="Home Address">Home Address</option>
                            <option value="Andhra Pradesh">Office Address</option>
                        </select>
                        <span class="error-message" id="addressTypeError"></span>
                    </span>
                    
                </div>
              


                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
              </div>

              <div  class="tab__content address-form-container" content id="edit-btn">
                <h2>Edit Address</h2>
                <form>
                    <div class="mb-3">
                        <label for="fullname" class="form-label">Full Name</label>
                        <input
                            type="text"
                            class="form-control"
                            id="fullname"
                            name="fullname"
                            placeholder="Enter your full name"
                            
                        />
                    </div>
                    <div class="mb-3">
                        <label for="city" class="form-label">City</label>
                        <input type="text" class="form-control" id="city" name="city" placeholder="Enter your city"  />
                    </div>
                    <div class="mb-3">
                        <label for="state" class="form-label">State</label>
                        <select id="state" name="state" class="form-select" >
                            <option value="{{state}}" elected>state</option>
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Chhattisgarh">Chhattisgarh</option>
                            <option value="Goa">Goa</option>
                            <option value="Gujarat">Gujarat</option>
                            <option value="Haryana">Haryana</option>
                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                            <option value="Jharkhand">Jharkhand</option>
                            <option value="Karnataka">Karnataka</option>
                            <option value="Kerala">Kerala</option>
                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Manipur">Manipur</option>
                            <option value="Meghalaya">Meghalaya</option>
                            <option value="Mizoram">Mizoram</option>
                            <option value="Nagaland">Nagaland</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Sikkim">Sikkim</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Telangana">Telangana</option>
                            <option value="Tripura">Tripura</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Uttarakhand">Uttarakhand</option>
                            <option value="West Bengal">West Bengal</option>
                            <option value="Chandigarh">Chandigarh</option>
                            <option value="Delhi">Delhi</option>
                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                            <option value="Ladakh">Ladakh</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="postalcode" class="form-label">Postal Code</label>
                        <input
                            type="text"
                            class="form-control"
                            id="postalcode"
                            name="postalcode"
                            placeholder="Enter your postal code"
                            
                        />
                    </div>
                    <div class="mb-3">
                        <label for="landmark" class="form-label">Landmark</label>
                        <input type="text" class="form-control" id="landmark" name="landmark" placeholder="Enter a landmark " />
                    </div>
                    <div class="mb-3">
                        <label for="phonenumber" class="form-label">Phone Number</label>
                        <input
                            type="text"
                            class="form-control"
                            id="phonenumber"
                            name="phonenumber"
                            placeholder="Enter your phone number"
                            
                        />
                    </div>
                    <p style="color: red"></p>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
              </div>
              
              








            <div class="tab__content" content id="change-password">
              <h3 class="tab__header">Change Password</h3>
              <div class="tab__body">
                <form class="form grid" action="/profile" id="changepasswordform">
                  <input
                    type="password"
                    placeholder="Current Password"
                    class="form__input"
                    name="currentPassword"
                    id="currentPassword"
                  />
                  <span class="error-message" id="passwordError"></span>
                  <input
                    type="password"
                    placeholder="New Password"
                    class="form__input"
                    name="newPassword"
                    id="newPassword"
                  />
                  <span class="error-message" id="newpasswordError"></span>
                  <input
                    type="password"
                    placeholder="Confirm Password"
                    class="form__input"
                    name="confirmPassword"
                    id="confirmPassword"
                  />
                  <span class="error-message" id="confirmpasswordError"></span>
                  <div class="form__btn">
                    <button type="submit" class="btn btn--md">Save</button>
                  </div>
                </form>
              </div>
            </div>




          
          
          </div>
        </div>
      </section>

    </main>
    <%-include("../../views/partials/user/footer")%>

    <!--=============== SWIPER JS ===============-->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!--=============== MAIN JS ===============-->



<script src="/js/main.js"></script>
<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>
  document.getElementById("updateprofileform").addEventListener("submit", async function(e) {
    e.preventDefault(); 

    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();

    const nameError = document.getElementById("nameError");
    const phoneError = document.getElementById("phoneError");

    nameError.textContent = "";
    phoneError.textContent = "";
    
    let isValid = true;

    if (name === "") {
      nameError.textContent = "Name can't be empty";
      nameError.style.color = "red";
      isValid = false;
    }

    if (phone === "") {
      phoneError.textContent = "Phone number can't be empty"; 
      phoneError.style.color = "red";
      isValid = false;
    }
    const phoneRegex = /^\d{10}$/; 
        if (!phoneRegex.test(phone)) {
            phoneError.textContent = "Please Enter a valid Phone Number";
            phoneError.style.color = "red";
            isValid = false;
        }
    
    if (isValid) {

      try {
        const response = await fetch('/profile/update', {
          method: 'POST',
          headers:{
                   'content-type':'application/json'
                 }, 
                body:JSON.stringify({name, phone})
        });

        const result = await response.json();

        if (result.success) {

          swal({
            title: "Success!",
            text: result.message,
            icon: "success",
            button: "OK"
          }).then(() => {
            
            window.location.href = '/profile'; 
          });
        } else {
          
          swal({
            title: "Error!",
            text: result.message,
            icon: "error",
            button: "Try Again"
          });
        }
      } catch (error) {
        console.error('Error:', error);
        swal({
          title: "Error!",
          text: "An unexpected error occurred.",
          icon: "error",
          button: "OK"
        });
      }
    }
  });
  document.getElementById("changepasswordform").addEventListener("submit", async function (e) {
  e.preventDefault(); // Prevent default form submission

  // Get the values from the input fields
  const currentPassword = document.getElementById("currentPassword").value.trim();
  const newPassword = document.getElementById("newPassword").value.trim();
  const confirmPassword = document.getElementById("confirmPassword").value.trim();

  const passwordError = document.getElementById("passwordError");
  const newpasswordError = document.getElementById("newpasswordError")
  const confirmpasswordError = document.getElementById("confirmpasswordError")

  passwordError.textContent = "";
  newpasswordError.textContent="";
  confirmpasswordError.textContent = "";

  let isValid =true;
  // Validate passwords before sending the request
  if (currentPassword==="" ||currentPassword.length<8) {
    passwordError.textContent = "Passwords must be atleast 8 Characters Long";
    passwordError.style.color = "red";
    isValid =false;
  }
  
  if(newPassword===""){
    newpasswordError.textContent = "Password must not be empty";
    newpasswordError.style.color = "red";
    isValid = false
  }

  if(confirmPassword===""){
    confirmpasswordError.textContent = "Passwords must not be empty";
    confirmpasswordError.style.color = "red"
  }

  if (newPassword !== confirmPassword) {
    confirmpasswordError.textContent = "New password and confirm password do not match.";
    confirmpasswordError.style.color = "red";
    isValid =false;
  }

  if(isValid){
  try {
    // Send the data to the server using Fetch API
    const response = await fetch("/profile/change-password", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        currentPassword,
        newPassword,
        confirmPassword
      }),
    });

    const result = await response.json();

    if (result.success) {
          // Show success message
          swal({
            title: "Success!",
            text: result.message,
            icon: "success",
            button: "OK"
          }).then(() => {
            // Redirect to profile page after closing alert
            window.location.href = '/profile'; // Adjust URL as necessary
          });
        } else {
          // Show error message
          swal({
            title: "Error!",
            text: result.message,
            icon: "error",
            button: "Try Again"
          });
        }
      } catch (error) {
        console.error('Error:', error);
        swal({
          title: "Error!",
          text: "An unexpected error occurred.",
          icon: "error",
          button: "OK"
        });
      }
    }
  });


document.getElementById("addaddressform").addEventListener("submit", async function(e) {
  e.preventDefault();

const addname = document.getElementById("addname").value.trim();
const city = document.getElementById("city").value.trim();
const state= document.getElementById("state").value
const pincode= document.getElementById("pincode").value.trim();
const landmark = document.getElementById("landmark").value.trim();
const addphone= document.getElementById("addphone").value.trim();
const addressType = document.getElementById("addressType").value


const addnameError = document.getElementById("addnameError");
const cityError = document.getElementById("cityError");
const stateError = document.getElementById("stateError");
const pincodeError = document.getElementById("pincodeError");
const landmarkError = document.getElementById("landmarkError");
const addphoneError = document.getElementById("addphoneError");
const addressTypeError = document.getElementById("addressTypeError")

addnameError.textContent = "";
cityError.textContent = "";
stateError.textContent = "";
pincodeError.textContent = "";
landmarkError.textContent = "";
addphoneError.textContent = "";
addressTypeError.textContent = "";


let isValid = true;

if(addname===""){
  addnameError.textContent = "Field is Required"
  addnameError.style.color = "red";
  isValid = false
}
 const cityRegex = /^[A-Za-z\s]+$/;
if(city===""){
  cityError.textContent = "Field is Required"
  cityError.style.color = "red";
  isValid = false
}
if(!cityRegex.test(city)){
  cityError.textContent = "Enter valid city name"
  cityError.style.color = "red";
  isValid = false
}

if(state==="state"){
  stateError.textContent = "Select any state"
  stateError.style.color = "red";
  isValid = false
}
const pincodeRegex =  /^\d{6}$/
if(!pincodeRegex.test(pincode)){
  pincodeError.textContent = "Enter Valid Pincode"
  pincodeError.style.color = "red";
  isValid = false
}
if(landmark===""){
  landmarkError.textContent = "Field is Required"
  landmarkError.style.color = "red";
  isValid = false
}

const phoneRegex = /^\d{10}$/; // Example: Only allows 10-digit numbers
        if (!phoneRegex.test(addphone)) {
            addphoneError.textContent = "Please Enter a valid Phone Number";
            addphoneError.style.color = "red";
            isValid = false;
        }

if(addressType==="--none--"){
  addressTypeError.textContent = "Select any Address Type"
  addressTypeError.style.color = "red";
  isValid = false
}





        if(isValid){
          try{
            const response = await fetch("/profile/add-address", {
              method:'POST',
              headers:{
                'Content-Type':'application/json'
              },
              body: JSON.stringify({
  name: addname,
  city,
  state,
  pincode,
  landmark,
  phonenumber: addphone,
  addressType
})


            })
      //       if(!response.ok) {
      //   throw new Error(`HTTP error! status: ${response.status}`);
      // }
            const result = await response.json()
            if(result.success){
              swal({
                title:"Success!",
                text:result.message,
                icon:"success",
                button:"OK"
              }).then(() => {
                window.location.href = '/profile'
              })
            }else{
              swal({
                title:"Error",
                text:result.message,
                icon:"error",
                button:"Try again"
              })
            }
          }catch(error){
            console.log("Error", error)
            swal({
              title:"Error",
              text:"An unexpected error occured",
              icon:"error",
              button:"ok"
            })
          }
        }
})
const inputs = ['addname', 'city', 'state', 'pincode', 'landmark', 'addphone', 'addressType'];

inputs.forEach(inputId => {
    document.getElementById(inputId).addEventListener('input', function() {
        const error = document.getElementById(inputId + 'Error');
        error.textContent = '';  // Clear error when user starts typing
    });
});


</script>
